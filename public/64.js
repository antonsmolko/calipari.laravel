(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{114:function(e,t,n){"use strict";var r={name:"ImageTableActions",props:{item:{type:Object,default:null},remove:{type:Boolean,default:!1}},computed:{hasCollection:function(){return Boolean(this.item.colorCollection)},isCollectionMainImage:function(){return this.hasCollection&&this.item.id===this.item.colorCollection.main_image_id}},methods:{onDelete:function(){this.$emit("delete",this.item)},onRemove:function(){this.$emit("remove",this.item.id)}}},a=n(0),o=Object(a.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.item?n("div",{staticClass:"table-actions"},[e.remove&&!e.hasCollection?n("control-button",{attrs:{title:"Отвязать",icon:"remove",color:"md-info"},on:{click:e.onRemove}}):e._e(),e._v(" "),n("router-button-link",{attrs:{title:"Сформировать проект",icon:"local_mall",color:"md-warning",to:{name:"cms.store.projects.create",params:{imageId:e.item.id}}}}),e._v(" "),e.hasCollection?n("router-button-link",{attrs:{title:"Коллекция",icon:"perm_media",color:"md-teal",to:{name:"cms.catalog.color-collections.images",params:{id:e.item.colorCollection.id}}}}):e._e(),e._v(" "),n("router-button-link",{attrs:{title:"Редактировать",icon:"edit",color:"md-success",to:{name:"cms.images.edit",params:{id:e.item.id}}}}),e._v(" "),n("control-button",{attrs:{title:"Удалить",icon:"delete",disabled:e.isCollectionMainImage,color:"md-danger"},on:{click:e.onDelete}})],1):e._e()}),[],!1,null,null,null);t.a=o.exports},186:function(e,t,n){var r=n(11),a=n(392);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1};r(a,o);e.exports=a.locals||{}},391:function(e,t,n){"use strict";var r=n(186);n.n(r).a},392:function(e,t,n){(e.exports=n(16)(!1)).push([e.i,"\n.upload-button[data-v-12064ae6] {\n    display: inline-block;\n}\n.md-file-input[data-v-12064ae6] {\n    display: none;\n}\n",""])},4:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"b",(function(){return m})),n.d(t,"g",(function(){return g})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return h}));var r=n(9),a=n.n(r),o=n(34),i=n.n(o);function c(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){c(o,r,a,i,s,"next",e)}function s(e){c(o,r,a,i,s,"throw",e)}i(void 0)}))}}var u={methods:{create:function(e){var t=this;return s(a.a.mark((function n(){var r,o,c,s,u,l,d,m,p;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.sendData,o=e.title,c=e.successText,s=e.redirectRoute,u=e.storeModule,l=void 0===u?null:u,d=e.action,m=void 0===d?"store":d,t.$store.commit("SET_LOADING",!0),p=l?"".concat(l,"/"):"",n.next=5,t.$store.dispatch("".concat(p).concat(m),r);case 5:return n.next=7,t.$router.push(s);case 7:return t.$store.commit("SET_LOADING",!1),n.abrupt("return",i.a.fire({title:c,text:"«".concat(o,"»"),timer:2e3,showConfirmButton:!1,icon:"success"}));case 9:case"end":return n.stop()}}),n)})))()}}},l={methods:{update:function(e){var t=this;return s(a.a.mark((function n(){var r,o,c,s,u,l,d,m;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.sendData,o=e.title,c=e.successText,s=e.redirectRoute,u=void 0===s?null:s,l=e.storeModule,d=void 0===l?null:l,t.$store.commit("SET_LOADING",!0),m=d?"".concat(d,"/"):"",n.next=5,t.$store.dispatch("".concat(m,"update"),r);case 5:if(!u){n.next=12;break}if(!(window.history.length>1)){n.next=10;break}t.$router.go(-1),n.next=12;break;case 10:return n.next=12,t.$router.push(u);case 12:return t.$store.commit("SET_LOADING",!1),n.abrupt("return",i.a.fire({title:c,text:"«".concat(o,"»"),timer:2e3,showConfirmButton:!1,icon:"success"}));case 14:case"end":return n.stop()}}),n)})))()}}},d={methods:{delete:function(e){var t=this;return s(a.a.mark((function n(){var r,o,i,c,s,u,l,d,m,g,v,h,b,y,x,w;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.payload,o=e.title,i=e.alertText,c=e.successText,s=e.storeModule,u=void 0===s?null:s,l=e.redirectRoute,d=void 0===l?null:l,m=e.tableMode,g=void 0!==m&&m,v=e.action,h=void 0===v?"delete":v,b=e.force,y=void 0!==b&&b,x=u?"".concat(u,"/"):"",w=y?"forceDelete":h,n.next=5,p(i);case 5:if(!n.sent.value){n.next=15;break}return t.$store.commit("SET_LOADING",!0),n.next=10,t.$store.dispatch("".concat(x).concat(w),{payload:r,tableMode:g});case 10:if(!d){n.next=13;break}return n.next=13,t.$router.push(d);case 13:return t.$store.commit("SET_LOADING",!1),n.abrupt("return",f(c,o));case 15:case"end":return n.stop()}}),n)})))()}}},m={methods:{deleteImageByIndex:function(e){var t=this;return s(a.a.mark((function n(){var r,o,i,c,s,u;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.id,o=e.index,i=e.alertText,c=e.successText,s=e.storeModule,u=void 0===s?null:s,n.next=3,p(i);case 3:if(!n.sent.value){n.next=11;break}return t.$store.commit("SET_LOADING",!0),n.next=8,t.$store.dispatch("".concat(u,"/deleteImageByIndex"),{id:r,index:o});case 8:return t.$store.commit("SET_LOADING",!1),n.next=11,f(c,o);case 11:case"end":return n.stop()}}),n)})))()}}},p=function(e){return i.a.fire({title:"Вы уверены?",text:"Данное действие удалит ".concat(e," безвозвратно!"),icon:"warning",showCancelButton:!0,customClass:{confirmButton:"md-button md-success btn-fill",cancelButton:"md-button md-danger btn-fill"},confirmButtonText:"Удалить",cancelButtonText:"Отменить",buttonsStyling:!1})},f=function(e,t){return i.a.fire({title:e,text:"«".concat(t,"»"),timer:2e3,icon:"success",showConfirmButton:!1})},g={methods:{upload:function(e){var t=this;return s(a.a.mark((function n(){var r,o,c,s,u,l,d;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.images,o=e.type,c=void 0===o?null:o,s=e.id,u=void 0===s?null:s,l=e.storeModule,d=(void 0===l?null:l)||"categories",!r.length){n.next=10;break}if(!u){n.next=8;break}return n.next=6,t.$store.dispatch("".concat(d,"/uploadImages"),{images:r,id:u,type:c});case 6:n.next=10;break;case 8:return n.next=10,t.$store.dispatch("images/store",r);case 10:return n.next=12,i.a.fire({title:"Изображения загружены!",text:"",timer:2e3,showConfirmButton:!1,icon:"success"});case 12:return n.abrupt("return",n.sent);case 13:case"end":return n.stop()}}),n)})))()}}},v={methods:{addImages:function(e){var t=this;return s(a.a.mark((function n(){var r,o;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.id,o=e.data,n.next=3,t.$store.dispatch("categories/addSelectedImages",{id:r,data:o});case 3:return n.next=5,t.$router.push({name:"cms.catalog.categories.images",params:{id:r}});case 5:return n.abrupt("return",i.a.fire({title:"Изображения добавлены!",text:"",timer:2e3,showConfirmButton:!1,icon:"success"}));case 6:case"end":return n.stop()}}),n)})))()}}},h={methods:{addImages:function(e){var t=this;return s(a.a.mark((function n(){var r,o,c,s;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.type,o=e.id,c=e.data,s=e.redirectRoute,n.next=3,t.$store.dispatch("subCategories/addSelectedImages",{type:r,id:o,data:c});case 3:return n.next=5,t.$router.push(s);case 5:return n.abrupt("return",i.a.fire({title:"Изображения добавлены!",text:"",timer:2e3,showConfirmButton:!1,icon:"success"}));case 6:case"end":return n.stop()}}),n)})))()}}}},688:function(e,t,n){"use strict";n.r(t);var r=n(9),a=n.n(r),o=n(2),i=n(5),c=n(4),s=n(84),u=n(98),l=n(114);function d(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g={name:"ImageList",mixins:[i.b,c.c,c.g],components:{ImageUploader:s.a,ImageListTable:u.a,ImageTableActions:l.a},props:{category_type:{type:String,default:"images"},id:{type:[Number,String],default:null}},data:function(){return{storeModule:"images"}},computed:p(p({},Object(o.d)({category:function(e){return e.categories.item}})),{},{resourceUrl:function(){return this.isCategoryPage?"/catalog/categories/".concat(this.id,"/images"):"/images/paginate"},isCategoryPage:function(){return"images"!==this.category_type}}),created:function(){this.init(this.category_type)},methods:p(p({},Object(o.b)({getCategoryAction:"categories/getItem",togglePublishAction:"table/togglePublish",removeImageAction:"categories/removeImage"})),{},{init:function(e){var t,n=this;return(t=a.a.mark((function t(){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("images"===e){t.next=3;break}return t.next=3,n.getCategoryAction(n.id);case 3:return r="images"===e?"Изображения":"Изображения категории «".concat(n.category.title,"»"),t.next=6,n.setPageTitle(r);case 6:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(e){d(o,r,a,i,c,"next",e)}function c(e){d(o,r,a,i,c,"throw",e)}i(void 0)}))})()},fileInputChange:function(e){var t=e.images;this.upload({images:t,type:this.category_type,id:this.id})},onRemove:function(e){this.removeImageAction({categoryId:this.id,imageId:e})},onDelete:function(e){this.delete({payload:e.id,title:e.id,alertText:"изображение «".concat(e.id,"»"),successText:"Изображение удалено!",storeModule:this.storeModule,tableMode:"table"})},togglePublish:function(e){this.togglePublishAction("/images/".concat(e,"/publish"))}})},v=n(0),h=Object(v.a)(g,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"md-layout"},[n("div",{staticClass:"md-layout-item"},[n("md-card",{staticClass:"mt-0"},[n("md-card-content",{staticClass:"md-between"},["images"===e.category_type?n("router-button-link",{attrs:{to:{name:"cms.dashboard"}}}):n("router-button-link",{attrs:{to:{name:"cms.catalog.categories.list",params:{category_type:e.category_type}}}}),e._v(" "),n("div",[n("router-button-link",{attrs:{icon:"content_copy",color:"md-info",title:"Поиск дубликатов",to:{name:"cms.images.find-duplicates",params:{id:"images"===e.category_type?0:e.id,category_type:e.category_type}}}}),e._v(" "),"images"===e.category_type?n("router-button-link",{attrs:{icon:"delete",color:"md-default",title:"Удаленные изображения",to:{name:"cms.images.trashed"}}}):e._e(),e._v(" "),"images"!==e.category_type?n("router-button-link",{attrs:{icon:"add",color:"md-success",title:"Добавить изображения",to:{name:"cms.catalog.categories.images.excluded",params:{id:e.id}}}}):e._e(),e._v(" "),n("image-uploader",{attrs:{multiple:!0},on:{change:e.fileInputChange}})],1)],1)],1),e._v(" "),n("progress-bar-loading")],1)]),e._v(" "),n("div",{staticClass:"md-layout"},[n("div",{staticClass:"md-layout-item"},[n("md-card",[n("card-icon-header",{attrs:{title:"Каталог изображений",icon:"image"}}),e._v(" "),n("md-card-content",[n("image-list-table",{attrs:{resourceUrl:e.resourceUrl},on:{publish:e.togglePublish},scopedSlots:e._u([{key:"actions-column",fn:function(t){var r=t.item;return[r?n("md-table-cell",{attrs:{"md-label":"Действия"}},[n("image-table-actions",{attrs:{item:r,remove:e.isCategoryPage},on:{remove:e.onRemove,delete:e.onDelete}})],1):e._e()]}}])})],1)],1)],1)])])}),[],!1,null,null,null);t.default=h.exports},84:function(e,t,n){"use strict";var r=n(9),a=n.n(r),o=n(2);function i(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){s(o,r,a,i,c,"next",e)}function c(e){s(o,r,a,i,c,"throw",e)}i(void 0)}))}}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p={name:"ImageUploader",mixins:[n(138).a],props:{multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},maxFileSize:{type:Number,default:15},width:{type:Number,default:1600},height:{type:Number,default:1200}},data:function(){return{previews:[],images:[],preview:null,image:null}},computed:d(d({},Object(o.d)({loading:function(e){return e.loading}})),{},{name:function(){return this.multiple?"images[]":"image"}}),methods:d(d({},Object(o.b)({setLoadingAction:"setLoading"})),{},{onChange:function(e){var t=this;return u(a.a.mark((function n(){var r;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.setLoadingAction(!0),(r=e.target.files||e.dataTransfer.files).length){n.next=4;break}return n.abrupt("return",null);case 4:if(!t.multiple){n.next=9;break}return n.next=7,t.handleMultipleChange(r);case 7:n.next=11;break;case 9:return n.next=11,t.handleSingleChange(r[0]);case 11:case"end":return n.stop()}}),n)})))()},handleMultipleChange:function(e){var t=this;return u(a.a.mark((function n(){var r,o;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.processMultipleImages(e);case 2:r=i(t.previews),o=i(t.images),t.$emit("change",{previews:r,images:o}),t.previews=[],t.images=[];case 7:case"end":return n.stop()}}),n)})))()},handleSingleChange:function(e){var t=this;return u(a.a.mark((function n(){var r,o;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.processImage(e);case 2:r=Object.assign({},t.preview),o=Object.assign({},t.image),t.$emit("change",{preview:r,image:o}),t.preview=null,t.image=null;case 7:case"end":return n.stop()}}),n)})))()},processMultipleImages:function(e){var t=this;return u(a.a.mark((function n(){var r,o,i,c;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=0,o=Object.values(e);case 1:if(!(r<o.length)){n.next=11;break}return i=o[r],n.next=5,t.processImage(i);case 5:c=n.sent,t.images.push(c.image),t.previews.push(c.preview);case 8:r++,n.next=1;break;case 11:case"end":return n.stop()}}),n)})))()},processSingleImage:function(e){var t=this;return u(a.a.mark((function n(){var r,o,i;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.processImage(e,t.width,t.height);case 2:r=n.sent,o=r.preview,i=r.image,t.preview=o,t.image=i;case 7:case"end":return n.stop()}}),n)})))()}})},f=(n(391),n(0)),g=Object(f.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"upload-button"},[n("input",{ref:"fileInput",staticClass:"md-file-input",attrs:{type:"file",multiple:e.multiple,name:e.name},on:{change:e.onChange}}),e._v(" "),n("md-button",{staticClass:"md-success md-just-icon",attrs:{disabled:e.disabled||e.loading},on:{click:function(t){return e.$refs.fileInput.click()}}},[n("md-icon",[e._v("get_app")]),e._v(" "),n("md-tooltip",{attrs:{"md-direction":"right"}},[e._v("Загрузить изображения")])],1)],1)}),[],!1,null,"12064ae6",null);t.a=g.exports}}]);